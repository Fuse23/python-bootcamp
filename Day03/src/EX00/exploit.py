from bs4 import BeautifulSoup as bs


def make_soup(path: str) -> bs:
    with open(path, 'r') as file:
        soup = bs(file, 'lxml')
    return soup


def change_title(soup: bs, title: str) -> None:
    soup.title.string = title


def add_header(soup: bs, string: str) -> None:
    name = soup.find('span', {'class': 'name'})
    new_h1 = soup.new_tag('h1')
    new_h1.string = name.text + string
    soup.find('body').insert(1, new_h1)


def script_insert(soup: bs, script: str) -> None:
    new_script = soup.new_tag('script')
    new_script.string  = script
    soup.find('body').append(new_script)


def change_link(soup: bs, new_link: str, text: str) -> None:
    link = soup.a
    link['href'] = new_link
    link.string = text


def make_new_file(soup: bs, path: str) -> None:
    with open(path, 'w') as file:
        file.write(str(soup))


if __name__ == '__main__':
    soup: bs = make_soup('../../materials/evilcorp.html')
    change_title(soup, 'Evil Corp - Stealing your money every day')
    add_header(soup, ', you are hacked!')
    script_insert(
        soup,
        '''
        hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
        function() { 
            var f = document.querySelector("form");
            f.setAttribute("onsubmit", "hacked()");
        },
        false
        );
        '''
    )
    change_link(soup, 'https://mrrobot.fandom.com/wiki/Fsociety', 'Fsociety')
    make_new_file(soup, '../../materials/evilcorp_hacked.html')
